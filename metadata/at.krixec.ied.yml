Categories:
  - Games
License: MIT
AuthorName: Krixec
AuthorEmail: krixec@yandex.com
SourceCode: https://codeberg.org/Krixec/IED-FDroid
IssueTracker: https://codeberg.org/Krixec/IED-FDroid/issues

AutoName: IED

RepoType: git
Repo: https://codeberg.org/Krixec/IED-FDroid.git

Builds:
  - versionName: Ni havas lingvojn
    versionCode: 12
    commit: 211940241201b1310d741fab4a02b9c43adf13b8
    timeout: 7200
    sudo:
      - apt-get update
      - apt-get install -y clang gettext pkg-config scons
    output: IED.apk
    srclibs:
      - Godot@4.2.1-stable
    build:
      - export HOME=$PWD
      - cp -R $$Godot$$ godot
      - keytool -keyalg RSA -genkey -v -keystore debug.keystore -storepass android
        -alias androiddebugkey -keypass android -dname "CN=Android Debug,O=Android,C=US"
      - mkdir -p ./.config/godot/
      - export SDK_PATH="export/android/android_sdk_path = \"$$SDK$$\""
      - export DEBUG_KEYSTORE_PATH="export/android/debug_keystore = \"$PWD/debug.keystore\""
      - echo '[gd_resource type="EditorSettings" format=2]' >> ./.config/godot/editor_settings-3.tres
      - echo "[resource]"  >> ./.config/godot/editor_settings-3.tres
      - echo $SDK_PATH >> ./.config/godot/editor_settings-3.tres
      - echo $DEBUG_KEYSTORE_PATH >> ./.config/godot/editor_settings-3.tres
      - echo 'export/android/debug_keystore_user = "androiddebugkey"' >> ./.config/godot/editor_settings-3.tres
      - echo 'export/android/debug_keystore_pass = "android"' >> ./.config/godot/editor_settings-3.tres
      - cd godot
      - scons -j `nproc` platform=linuxbsd use_llvm=yes unix_global_settings_path=".."
        profile=fdroid/godot-build-options.py
      - export ANDROID_NDK_ROOT=$$NDK$$
      - scons -j `nproc` use_llvm=yes p=android target=template_release  unix_global_settings_path=".."
        android_arch=armv7 profile=fdroid/godot-build-options.py
      - scons -j `nproc` use_llvm=yes p=android target=template_release  unix_global_settings_path=".."
        android_arch=arm64v8 profile=fdroid/godot-build-options.py
      - pushd platform/android/java/
      - gradle generateGodotTemplates
      - popd
      - cd ..
      - mkdir -p ./.local/share/godot/templates/4.2.1.stable/
      - echo "4.2.1.stable" >> ./.local/share/godot/templates/4.2.1.stable/version.txt
      - cp godot/bin/android_release.apk ./.local/share/godot/templates/4.2.1.stable/
      - ./godot/bin/godot.* --headless --export-release Android IED.apk
    ndk: 23.2.8568313

AutoUpdateMode: Version
UpdateCheckMode: Tags
UpdateCheckData: export_presets.cfg|version/code=(\d+)|.|version/name="([^"]*)"
CurrentVersionCode: 12
